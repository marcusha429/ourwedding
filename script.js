emailjs.init('uslz-38maofgET7_g');

const translations = {
  en: {
     // —— Main ——
    groomName: "MARCUS HA",
    brideName: "THANH THUY",
    meetthebride: "Meet The Bride",
    thechurch: "The Church",
    therestaurant: "The Restaurant",
    yourwish: "Your Wish",

     // —— Countdown Timer ——
    mins: "Mins",
    days: "Days",
    hours: "Hours",
    seconds: "Seconds",

     // —— Wish Form ——
    sendusyourwish: "Send us your wish",
    message: "We cherish your heartfelt wishes. Please leave your blessing below.",
    send: "Send Wish",
    back: "Back",
    yourgift: "Your Gift",

     // —— Church Form ——
    youreinvited: "You're Invited",
    tenthanhgroom: "Joseph",
    tenthanhbride: "Clara",
    groomNamefull: "Marcus Ha",
    brideNamefull: "Tran Thi Thanh Thuy",
    churchaddress: "Join us at Tan Chi Linh Church<br>" + 
    "6/25 Pham Van Hai, Ward 3, Tan Binh District",
    churchtime: "June 28th, 2025<br>"+
    "4:00 PM (GMT+7)",
    quote: "&quotWe become what we love and who we love shapes what we become.&quot<br>" +
    "— St. Clare of Assisi —",

     // —— Restaurant Form ——
    additional : "  ",
    weddingdetails: "Wedding Details",
    restauranttime: "June 28th, 2025<br>" + 
    "6:00 PM (GMT+7)<br><br>",
    restaurantaddress: "Asiana Plaza Convention Center<br>" +
    "Alexa Hall - 10th Floor<br>"+
    "284–286 Vuon Lai, Phu Tho Hoa, Tan Phu District<br>",
    gettingthere: "Getting There",
    drinks: "Drinks",
    alldrinks: "• Coke • Beer • Water",
    goodeats: "Good Eats",
    allfoods: "• Roasted Chicken & Pumpkin Salad<br>"+ 
    " • Oven-Baked Pork Rolls with Kimchi<br>"+ 
    " • Fish Maw Soup with Black Moss<br>"+ 
    " • Seafood in Pumpkin Sauce<br>" + 
    " • Roasted Chicken with Miso Sauce & Chef's Special Sticky Rice<br>"+
    " • Teochew-Style Seafood Hot Pot with Steamed Noodles<br>"+
    " • Sweet Red Date Soup with Palm Seeds",

     // —— Meet The Bride Form ——
    ourstory: "Our Story",
    firstsentence: "Seven years woven tightly.",
    secondsentence: "I greets the sun in Vietnam as he whispers goodnight from the U.S.",
    thirdsentence: "Our love, tested by miles and strengthened by patience, waits joyfully for the day we'll finally share every sunrise side by side.",
    lastsentence: "And our new chapter begins...",
    invitation: "Reception Invitation",
    togetherwithourfamilies: "Together with our families,",
    inviteat: "invite you to celebrate at Home.",
    meettime: "June 28th, 2025<br />"+
    "1:00 PM (GMT+7)",
    lastword: "We look forward to sharing this joyful moment!"

  },
  vi: {
     // —— Main ——
    groomName: "MARCUS HÀ",
    brideName: "THANH THUỲ",
    meetthebride: "Lễ Rước Dâu",
    thechurch: "Lễ Hôn Phối",
    therestaurant: "Tiệc Cưới",
    yourwish: "Gửi Lời Chúc",

      // —— Countdown Timer ——
    mins: "Phút",
    days: "Ngày",
    hours: "Giờ",
    seconds: "Giây",

      // —— Wish Form ——
    sendusyourwish: "Lời Chúc Mừng",
    message: "Hãy để lại lời chúc mừng của bạn bên dưới. Xin gửi lời cảm ơn sâu sắc đến bạn. ",
    send: "Gửi",
    back: "Quay Lại",
    yourgift: "Quà Mừng Cưới",

      // —— Church Form ——
    youreinvited: "Lễ Thành Hôn",
    tenthanhgroom: "Giuse",
    tenthanhbride: "Clara",
    groomNamefull: "Marcus Hà",
    brideNamefull: "Trần Thị Thanh Thùy",
    churchaddress: "Hôn lễ được cử hành tại Nhà Thờ Tân Chí Linh<br>" + 
    "6/25 Phạm Văn Hai, Phường 3, Quận Tân Bình",
    churchtime: "28.06.2025<br>"+
    "Vào lúc 16:00",
    quote: " &quotChúng ta sẽ trở thành những gì chúng ta yêu thương và người chúng ta yêu thương sẽ định hình nên con người chúng ta.&quot<br>" +
    "— Thánh Clara, Đồng Trinh —",

      // —— Restaurant Form ——
    additional: "Thân mời bạn đến dự",
    weddingdetails: "Lễ Thành Hôn",
    restauranttime: "28.06.2025<br>" + 
    "Vào lúc 18:00<br><br>",
    restaurantaddress: "Asiana Plaza<br>" +
    "Sảnh Alexa - Tầng 10<br>" +
    "284–286 Vườn Lài, Phú Thọ Hòa, Tân Phú<br>",
    gettingthere: "Bản Đồ",
    drinks: "Thức Uống",
    alldrinks: "• Nước Ngọt • Bia • Nước Suối",
    goodeats: "Món Ăn",
    allfoods: "• Xà Lách Bí Đỏ - Gà Nướng<br>"+ 
    " • Heo Cuộn Kim Chi Đút Lò<br>"+ 
    " • Súp Bóng Cá Tóc Tiên<br>"+
    " • Hải Sản Xốt Bí Đỏ<br>" +
    " • Gà Quay Xốt Miso - Xôi Đặc Biệt<br>" + 
    " • Lẩu Hải Sản Triều Châu - Mì Hấp<br>" +
    " • Chè Táo Đỏ Hạt Đác",

      // —— Meet The Bride Form ——
    ourstory: "Một Hành Trình Dài",
    firstsentence: "Bảy năm bên nhau.",
    secondsentence: "Tớ đón bình minh ở Việt Nam cũng là lúc anh ấy nhắn chúc ngủ ngon từ Mỹ.",
    thirdsentence: "Tình yêu của tụi mình, bị thách thức bởi khoảng cách và bền bỉ cùng với sự kiên nhẫn, và giờ đây cùng nhau chờ đợi ngày tụi mình sẽ về  chung một nhà.",
    lastsentence: "Và một bước ngoặt mới của cuộc đời đã bắt đầu...",
    invitation: "Trân Trọng Kính Mời",
    togetherwithourfamilies: "Đến dự buổi tiệc cùng với gia đình chúng tôi,",
    inviteat: "Hôn lễ được cử hành tại Tư Gia",
    meettime: "Ngày 28 tháng 6 năm 2025<br />"+
    "Vào lúc 13:00",
    lastword: "Sự hiện diện của bạn là niềm vinh hạnh cho chúng tôi!"
  }
};

//MUSIC 
const musicList = [
    'music/summerisforfallinginlove.mp3',
    'music/thoseeyes.mp3',
    'music/mylovemineallmine.mp3',
    'music/ithinktheycallthislove.mp3',
    'music/blue.mp3',
  ];
  let currentAudio = null;
  let isPlaying = false;
  
  function initAudio() {
    playRandomMusic();
  }
  function playRandomMusic() {
    if (isPlaying) return;
  
    const idx = Math.floor(Math.random() * musicList.length);
    currentAudio = new Audio(musicList[idx]);
    currentAudio.volume = 0.5;
    currentAudio.addEventListener('ended', () => {
      const next = (musicList.indexOf(currentAudio.src.split('/').pop()) + 1) % musicList.length;
      currentAudio.src = musicList[next];
      currentAudio.play().catch(e => console.log("Playback failed:", e));
    });
    currentAudio.play()
      .then(() => {
        isPlaying = true;
        document.getElementById('musicToggle').textContent = '🎵';
      })
      .catch(err => {
        console.log("Audio failed:", err);
        isPlaying = false;
        document.getElementById('musicToggle').textContent = '🔇';
        document.addEventListener('click', initAudio, { once: true });
      });
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    // —— two-step grid logic ——
    const formMap = {
      'wish-btn':       'wish-form-container',
      'schedule-btn':     'schedule-form-container',
      'gallery-btn': 'gallery-form-container',
      'home-btn':       'home-form-container',
    };
    const gridItems = document.querySelectorAll('.grid-item');
    gridItems.forEach(item => {
      item.addEventListener('click', () => {
        if (!item.classList.contains('active')) {
          gridItems.forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          return;  // stop here on first tap
        }
        // second tap → open form
        const formId = formMap[item.id];
        if (formId) {
          document.getElementById(formId).style.display = 'flex';
          gridItems.forEach(i => i.classList.remove('active'));
        }
      });
    });
  
    // —— single music-control creation ——
    const musicControls = document.createElement('div');
    musicControls.className = 'music-controls';
    musicControls.style = 'position: fixed; bottom: 20px; right: 20px; z-index: 1000;';
    musicControls.innerHTML = `
      <button onclick="toggleMusic()" id="musicToggle"
              style="padding:10px; border-radius:50%; background:rgba(255,255,255,0.8);">
        🔇
      </button>`;
    document.body.appendChild(musicControls);
  
    initAudio();  // kick off music
  
    // —— door logic ——
    const landing = document.getElementById("landing");
    document.querySelectorAll(".door").forEach(door => {
      door.addEventListener("click", () => {
        if (!landing.classList.contains("open")) {
          landing.classList.add("open");
        }
      });
    });
  
    // —— countdown ——
    updateCountdown();
    setInterval(updateCountdown, 1000);
  });

function toggleMusic() {
    if (!currentAudio) {
        playRandomMusic();
        return;
    }

    if (currentAudio.paused) {
        currentAudio.play()
            .then(() => {
                isPlaying = true;
                document.getElementById('musicToggle').textContent = '🎵';
            })
            .catch(error => console.log("Playback failed:", error));
    } else {
        currentAudio.pause();
        isPlaying = false;
        document.getElementById('musicToggle').textContent = '🔇';
    }
}


// Form close functions
function closeWishForm() {
    document.getElementById("wish-form-container").style.display = "none";
    document.querySelector('.grid-item.active')?.classList.remove('active');
}

function closeScheduleForm() {
    document.getElementById("schedule-form-container").style.display = "none";
    document.querySelector('.grid-item.active')?.classList.remove('active');
}

function closeHomeForm() {
    document.getElementById("home-form-container").style.display = "none";
    document.querySelector('.grid-item.active')?.classList.remove('active');
}

function closeGalleryForm() {
  document.getElementById("gallery-form-container").style.display = "none";
  document.querySelector('.grid-item.active')?.classList.remove('active');
}

function sendWish() {
  const nameEl = document.getElementById("name");
  const wishEl = document.getElementById("wish");
  const name = nameEl.value.trim();
  const wish = wishEl.value.trim();

  if (!name || !wish) {
    alert("Please fill out both your name and your wish!");
    return;
  }

  const templateParams = {
    user_name: name,
    message: wish
  };

  // send via EmailJS
  emailjs.send('service_g7g3w0g', 'template_xyez4a7', templateParams)
    .then(response => {
      console.log('SUCCESS:', response.status, response.text);
      alert("Thank you! Your wish has been sent.");
      closeWishForm();
      nameEl.value = "";
      wishEl.value = "";
    })
    .catch(err => {
      console.error('FAILED to send wish:', err);
      alert("Oops—something went wrong. Please try again later.");
    });
}

function updateCountdown() {
    const target = new Date("June 28, 2025 13:00:00 GMT+0700").getTime();
    const now = Date.now();
    const diff = target - now;

    if (diff <= 0) {
        document.querySelector(".countdown-timer").innerHTML = 
            "<div class='countdown-box'><div class='countdown-number'>It's time!</div></div>";
        return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hrs = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const mins = Math.floor((diff / (1000 * 60)) % 60);
    const sec = Math.floor((diff / 1000) % 60);

    document.getElementById("days").textContent = String(days).padStart(2, "0");
    document.getElementById("hours").textContent = String(hrs).padStart(2, "0");
    document.getElementById("minutes").textContent = String(mins).padStart(2, "0");
    document.getElementById("seconds").textContent = String(sec).padStart(2, "0");
}

setInterval(updateCountdown, 1000);
updateCountdown();

// ---- language handling ----
const langOverlay = document.getElementById('lang-overlay')
langOverlay.style.display = 'flex';


// When user clicks on a language button…
langOverlay.querySelectorAll('button[data-lang]').forEach(btn => {
  btn.addEventListener('click', () => {
    const lang = btn.dataset.lang;
    localStorage.setItem('lang', lang);
    applyLanguage(lang);
    langOverlay.style.display = 'none';
  });
});

// Function to swap all text and placeholders
function applyLanguage(lang) {
  // text content
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (translations[lang][key]) {
      el.textContent = translations[lang][key];
    }
  });
  // placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.dataset.i18nPlaceholder;
    if (translations[lang][key]) {
      el.placeholder = translations[lang][key];
    }
  });
  // 3) HTML content (for anything with tags, like your address)
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    const key = el.dataset.i18nHtml;
    if (translations[lang][key]) {
      el.innerHTML = translations[lang][key];
    }
  });
}


// ─── cover-flow angle (in degrees) ───
const ANGLE = 30;

document.addEventListener('DOMContentLoaded', () => {
  const slides   = Array.from(document.querySelectorAll('.slide'));
  const sliderEl = document.querySelector('.slider');
  let curr = 0;

  // layout function handles both desktop (horizontal) and mobile (vertical)
  function layout() {
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    const W = sliderEl.offsetWidth;
    const H = sliderEl.offsetHeight;

    slides.forEach((slide, i) => {
      const offset = i - curr;
      const absOff = Math.abs(offset);
      let transformStr;

      if (!isMobile) {
        // ── Desktop: horizontal cover-flow ──
        const x     = offset * (W * 0.5);
        const rotY  = offset * ANGLE;
        const scale = offset === 0 ? 1.2 : 0.6;
        transformStr = `
          translateX(${x}px)
          rotateY(${rotY}deg)
          scale(${scale})
        `;
      } else {
        // ── Mobile: vertical slide-down ──
        const y     = offset * (H * 0.5);
        const rotX  = offset * (ANGLE * 0.6);
        const scale = offset === 0 ? 1.2 : 0.6;
        transformStr = `
          translateY(${y}px)
          rotateX(${rotX}deg)
          scale(${scale})
        `;
      }

      slide.style.transform = transformStr.trim();
      slide.style.zIndex    = slides.length - absOff;
    });
  }
  // initial layout
  layout();

  // re-layout on browser resize/orientation change
  window.addEventListener('resize', layout);

  // ─── navigation handlers ───
  window.nextSlide = () => {
    curr = (curr + 1) % slides.length;
    layout();
  };
  window.prevSlide = () => {
    curr = (curr - 1 + slides.length) % slides.length;
    layout();
  };

  // ─── integrate gallery into the grid’s double-tap logic ───
Object.entries(formMap).forEach(([btnId, formId]) => {
  const btn   = document.getElementById(btnId);
  const formEl = document.getElementById(formId);

  btn.addEventListener('click', () => {
    const isOpen = formEl.style.display === 'flex';
    formEl.style.display = isOpen ? 'none' : 'flex';

    if (!isOpen && formId === 'gallery-form-container') {
      // just opened the gallery: position slides
      setTimeout(layout, 50);
    }
    if (isOpen && formId === 'gallery-form-container') {
      // just closed: reset to first slide
      curr = 0;
      layout();
    }
  });
});

  const wrapper = document.querySelector('.slider-wrapper');
  let touchStartY = 0;

  wrapper.addEventListener('touchstart', e => {
    touchStartY = e.changedTouches[0].clientY;
  });

  wrapper.addEventListener('touchend', e => {
    const touchEndY = e.changedTouches[0].clientY;
    const delta = touchStartY - touchEndY;
    const threshold = 50;  // swipe threshold in px

    if (Math.abs(delta) > threshold) {
      if (delta > 0) {
        nextSlide();     // swipe up → next
      } else {
        prevSlide();     // swipe down → previous
      }
    }
  });
});

